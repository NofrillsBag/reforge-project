<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hephaestus Dashboard</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom styles for a better look and feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .main-content {
            display: none;
        }
        .main-content.active {
            display: block;
        }
        .tab-btn.active {
            background-color: #4f46e5;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 bg-white p-6 rounded-xl shadow-md border border-gray-200">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Hephaestus Dashboard</h1>
                <p class="text-gray-600 mt-1">Welcome back. Your goal is to get back to <span class="font-semibold text-indigo-600">Running</span>.</p>
            </div>
            <div class="mt-4 md:mt-0 flex items-center gap-4 bg-yellow-100 border border-yellow-300 text-yellow-800 font-semibold py-2 px-4 rounded-lg">
                <i class="fa-solid fa-coins text-yellow-600"></i>
                <span id="currency-total" class="text-lg">0</span>
                <span>Points</span>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="mb-6">
            <div class="flex flex-wrap border-b border-gray-300">
                <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200 active" data-tab="dashboard">
                    <i class="fa-solid fa-tasks mr-2"></i>Habit Tracking
                </button>
                <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200" data-tab="journal">
                    <i class="fa-solid fa-book-medical mr-2"></i>Private Journal
                </button>
                <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200" data-tab="specialist">
                    <i class="fa-solid fa-chart-pie mr-2"></i>Specialist View
                </button>
                <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200" data-tab="longterm">
                    <i class="fa-solid fa-hourglass-half mr-2"></i>Long Term
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <main>
            <!-- Habit Tracking / Dashboard View -->
            <div id="dashboard" class="main-content active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Daily Habits -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md border border-gray-200">
                        <h2 class="text-xl font-bold mb-4">Daily Habits</h2>
                        <div id="task-list" class="space-y-4">
                            <!-- Tasks will be injected by JS -->
                        </div>
                    </div>
                    <!-- Reminders -->
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                        <h2 class="text-xl font-bold mb-4">Reminders & Long-Term Goals</h2>
                        <div class="space-y-3">
                            <div class="bg-indigo-100 p-3 rounded-lg">
                                <p class="font-semibold text-indigo-800">Primary Goal</p>
                                <p class="text-indigo-700">Regain strength for running.</p>
                            </div>
                            <div class="bg-green-100 p-3 rounded-lg">
                                <p class="font-semibold text-green-800">Next Appointment</p>
                                <p class="text-green-700">Physiotherapy - Aug 15, 2025</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journal View -->
            <div id="journal" class="main-content">
                <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-xl font-bold mb-4">Private Journal</h2>
                    <p class="text-gray-600 mb-4">Your thoughts are safe here. This data is only for you.</p>
                    <textarea id="journal-entry" class="w-full h-48 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="How are you feeling today? What's on your mind?"></textarea>
                    <button id="save-journal" class="mt-4 bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors duration-200">Save Entry</button>
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold mb-4">Past Entries</h3>
                        <div id="journal-history" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                             <!-- Journal history will be injected here -->
                             <div class="bg-gray-50 p-4 rounded-lg border">
                                <p class="text-sm text-gray-500 mb-2">August 1, 2025</p>
                                <p>Felt a bit frustrated today during the exercises. The memory of running is strong, but I'm trying to focus on the small wins.</p>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Specialist View -->
            <div id="specialist" class="main-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-md border border-gray-200">
                        <h2 class="text-xl font-bold mb-4">Patient Metrics Overview</h2>
                        <canvas id="metricsRadarChart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
                        <h2 class="text-xl font-bold mb-4">Patient Summary</h2>
                        <div class="space-y-4 text-sm">
                            <div>
                                <h3 class="font-semibold text-gray-700">Life Change Event</h3>
                                <p class="text-gray-600" id="summary-lifeChange"></p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-700">Reported Impact</h3>
                                <p class="text-gray-600" id="summary-impact"></p>
                            </div>
                             <div>
                                <h3 class="font-semibold text-gray-700">Stated Goal</h3>
                                <p class="text-gray-600" id="summary-goals"></p>
                            </div>
                            <div class="grid grid-cols-2 gap-2 pt-2 border-t mt-4">
                            <div class="font-semibold">PHQ-9 Score:</div><div id="summary-phq"></div>
                            <div class="font-semibold">GAD-7 Score:</div><div id="summary-gad"></div>
                            <div class="font-semibold">Pain (1-10):</div><div id="summary-pain"></div>
                            <div class="font-semibold">Energy (1-10):</div><div id="summary-energy"></div>
                            <div class="font-semibold">Brain Fog:</div><div id="summary-fog"></div>
                            <div class="font-semibold">Digital Wellness (0–10):</div><div id="summary-digital"></div>
                            <div class="font-semibold">Lifestyle (0–10):</div><div id="summary-lifestyle"></div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Long Term View -->
            <div id="longterm" class="main-content">

            </div>    
    </div>
    
    <!-- Navigation Tabs -->
    <div class="mb-6">
      <div class="flex flex-wrap border-b border-gray-300">
        <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200 active" data-tab="dashboard">
          <i class="fa-solid fa-tasks mr-2"></i>Habit Tracking
        </button>
        <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200" data-tab="journal">
          <i class="fa-solid fa-book-medical mr-2"></i>Private Journal
        </button>
        <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200" data-tab="specialist">
          <i class="fa-solid fa-chart-pie mr-2"></i>Specialist View
        </button>
        <button class="tab-btn py-3 px-6 font-semibold text-gray-600 hover:bg-gray-200 rounded-t-lg transition-colors duration-200" data-tab="longterm">
          <i class="fa-solid fa-hourglass-half mr-2"></i>Long-Term
        </button>
        </div>
        </div>
      </main>
      </div>
    </div>

<script>

  const userData = JSON.parse(localStorage.getItem("hephaestusUserData") || "{}");

  const patientData = {
    "lifeChange": "Car Crash, leg injury can no longer run. One leg, left",
    "impact": "I used to love running, now I can not run.",
    "goals": "Running",
    "phq": "15",
    "gad": "11",
    "mood": "-1",
    "pain": "6",
    "sleep": "6",
    "energy": "3",
    "focus": "5",
    "fog": "yes",
    "contacts": "2",
    "confidence": "sometimes",
    "screenTime": "5",
    "sleepConsistency": "7",
    "activityLevel": "4",
    "junkFoodFreq": "4"
  };

  



  // --- Existing state + logic ---
  let appState = {
    currency: 0,
    dailyTasks: [
      { id: 1, text: "10 minutes of prescribed physical therapy", completed: false, points: 2 },
      { id: 2, text: "5 minutes of mindfulness or meditation", completed: true, points: 1 },
      { id: 3, text: "Write one entry in your journal", completed: false, points: 1 },
      { id: 4, text: "Connect with one person (call, text, etc.)", completed: false, points: 1 },
      { id: 5, text: "Review long-term goals and visualize success", completed: false, points: 1 }
    ],
    journalEntries: [
      { date: 'August 1, 2025', text: "Felt a bit frustrated today during the exercises. The memory of running is strong, but I'm trying to focus on the small wins." }
    ]
  };

  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.tab-btn');
    const contents = document.querySelectorAll('.main-content');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        contents.forEach(c => c.classList.remove('active'));
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    renderTaskList();
    renderSpecialistView();
    setupJournal();
  });

  function renderTaskList() {
    const taskListContainer = document.getElementById('task-list');
    taskListContainer.innerHTML = '';
    let currentCurrency = 0;

    appState.dailyTasks.forEach(task => {
      if (task.completed) currentCurrency += task.points;
      const taskElement = document.createElement('div');
      taskElement.className = `flex items-center justify-between p-4 rounded-lg border transition-all duration-200 ${task.completed ? 'bg-green-50 border-green-200' : 'bg-gray-50'}`;
      taskElement.innerHTML = `
        <div class="flex items-center">
          <input type="checkbox" id="task-${task.id}" data-task-id="${task.id}" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" ${task.completed ? 'checked' : ''}>
          <label for="task-${task.id}" class="ml-3 text-gray-700 ${task.completed ? 'line-through text-gray-500' : ''}">${task.text}</label>
        </div>
        <div class="font-semibold text-sm ${task.completed ? 'text-green-600' : 'text-yellow-600'}">+${task.points} pts</div>
      `;
      taskListContainer.appendChild(taskElement);
    });

    appState.currency = currentCurrency;
    document.getElementById('currency-total').textContent = appState.currency;

    document.querySelectorAll('#task-list input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', handleTaskToggle);
    });
  }

  function handleTaskToggle(event) {
    const taskId = parseInt(event.target.dataset.taskId);
    const task = appState.dailyTasks.find(t => t.id === taskId);
    if (task) {
      task.completed = event.target.checked;
      let newCurrency = 0;
      appState.dailyTasks.forEach(t => { if (t.completed) newCurrency += t.points; });
      appState.currency = newCurrency;
      document.getElementById('currency-total').textContent = appState.currency;
      renderTaskList();
    }
  }

  function setupJournal() {
    const saveBtn = document.getElementById('save-journal');
    const journalInput = document.getElementById('journal-entry');
    saveBtn.addEventListener('click', () => {
      if (journalInput.value.trim() === '') return;
      const newEntry = {
        date: new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }),
        text: journalInput.value.trim()
      };
      appState.journalEntries.unshift(newEntry);
      journalInput.value = '';
      renderJournalHistory();
    });
    renderJournalHistory();
  }

  function renderJournalHistory() {
    const historyContainer = document.getElementById('journal-history');
    historyContainer.innerHTML = '';
    appState.journalEntries.forEach(entry => {
      const entryDiv = document.createElement('div');
      entryDiv.className = 'bg-gray-50 p-4 rounded-lg border';
      entryDiv.innerHTML = `<p class="text-sm text-gray-500 mb-2">${entry.date}</p><p>${entry.text}</p>`;
      historyContainer.appendChild(entryDiv);
    });
  }

  function renderSpecialistView() {
    const metrics = calculateMetrics();
    document.getElementById('summary-lifeChange').textContent = patientData.lifeChange;
    document.getElementById('summary-impact').textContent = patientData.impact;
    document.getElementById('summary-goals').textContent = patientData.goals;
    document.getElementById('summary-phq').textContent = patientData.phq;
    document.getElementById('summary-gad').textContent = patientData.gad;
    document.getElementById('summary-pain').textContent = patientData.pain;
    document.getElementById('summary-energy').textContent = patientData.energy;
    document.getElementById('summary-fog').textContent = patientData.fog;
    document.getElementById('summary-digital').textContent = metrics.digitalWellness;
    document.getElementById('summary-lifestyle').textContent = metrics.lifestyle;

    const ctx = document.getElementById('metricsRadarChart').getContext('2d');
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['Emotional', 'Physical', 'Cognitive', 'Social', 'Digital Wellness', 'Lifestyle'],
        datasets: [{
          label: 'Patient Self-Reported Metrics',
          data: [
            metrics.emotional,
            metrics.physical,
            metrics.cognitive,
            metrics.social,
            metrics.digitalWellness,
            metrics.lifestyle
          ],
          fill: true,
          backgroundColor: 'rgba(79, 70, 229, 0.2)',
          borderColor: 'rgb(79, 70, 229)',
          pointBackgroundColor: 'rgb(79, 70, 229)',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: 'rgb(79, 70, 229)'
        }]
      },
      options: {
        elements: { line: { borderWidth: 3 } },
        scales: {
          r: {
            angleLines: { display: false },
            suggestedMin: 0,
            suggestedMax: 10,
            pointLabels: {
              font: { size: 14, weight: 'bold' }
            }
          }
        },
        plugins: { legend: { position: 'top' } }
      }
    });
  }

  function calculateMetrics() {
    const p = patientData;
    const phqScore = 10 - ((parseInt(p.phq ?? "0") || 0) / 27 * 10);
    const gadScore = 10 - ((parseInt(p.gad ?? "0") || 0) / 21 * 10);
    const moodScore = (parseInt(p.mood ?? "0") || 0) + 5;
    const confidenceScore = p.confidence === 'sometimes' ? 5 : (p.confidence === 'always' ? 10 : 2);
    const painScore = 10 - (parseInt(p.pain ?? "0") || 0);
    const sleepScore = parseInt(p.sleep ?? "0") || 0;
    const energyScore = parseInt(p.energy ?? "0") || 0;
    const focusScore = parseInt(p.focus ?? "0") || 0;
    const fogScore = p.fog === 'yes' ? 2 : 8;
    const socialScore = Math.min(10, ((parseInt(p.contacts ?? "0") || 0) / 5 * 10));
    const screenTime = parseFloat(p.screenTime ?? "0") || 0;
    const screenScore = 10 - Math.min(10, screenTime);
    const sleepConsistency = parseFloat(p.sleepConsistency ?? "0") || 0;
    const activityLevel = parseFloat(p.activityLevel ?? "0") || 0;
    const junkFoodFreq = parseFloat(p.junkFoodFreq ?? "0") || 0;
    const lifestyleScore = (sleepConsistency + activityLevel + (10 - Math.min(10, junkFoodFreq))) / 3;

    return {
      emotional: parseFloat(((phqScore + gadScore + moodScore + confidenceScore) / 4).toFixed(1)),
      physical: parseFloat(((painScore + sleepScore + energyScore) / 3).toFixed(1)),
      cognitive: parseFloat(((focusScore + fogScore) / 2).toFixed(1)),
      social: parseFloat(socialScore.toFixed(1)),
      digitalWellness: parseFloat(screenScore.toFixed(1)),
      lifestyle: parseFloat(lifestyleScore.toFixed(1))
    };
  }

</script>

</body>
</html>
